<form class="babylon-system babylon-wrapper boss-sheet theme-{{sheetCfg.theme}}" autocomplete="off" style="--accent-color: {{sheetCfg.colors.accent}}; --energy-color: {{sheetCfg.colors.energy}}; --damage-color: {{sheetCfg.colors.damage}}; --shield-color: {{sheetCfg.colors.shield}};">
  <!-- ===== Unified Header (same frame as character) ===== -->
  <header class="sheet-header bx-header boss-header">
  <div class="bx-portrait-frame">
    <img class="profile-img" src="{{img}}" title="{{actor.name}}" data-edit="img" />
  </div>

  <div class="bx-header-main">
    <div class="bx-name-row">
      <input class="actor-name" type="text" name="name" value="{{actor.name}}" placeholder="ë³´ìŠ¤ ì´ë¦„"/>
      <div class="name-meta">
        <span class="meta-item">ğŸ›¡ {{system.combat.shieldStacks}} / {{system.combat.shieldStacksMax}}</span>
        <span class="meta-dot">â€¢</span>
        <span class="meta-item">ğŸŸ¥ {{system.combat.damageStacks}} / {{system.combat.damageStacksMax}}</span>
        <span class="meta-dot">â€¢</span>
        <span class="meta-item">âš¡ {{system.combat.energy}} / {{system.combat.energyMax}}</span>
      </div>
    </div>

    <div class="bx-subrow">
      <div class="bx-actions-row">
        <button type="button" class="pill ghost" data-action="reset-combat" title="ë³´í˜¸ë§‰/í”¼ê²©/ì—ë„ˆì§€ 0ìœ¼ë¡œ ì´ˆê¸°í™”">ì´ˆê¸°í™”</button>
        <button type="button" class="pill ghost" data-action="apply-token" title="ì´ˆìƒ ì´ë¯¸ì§€ë¥¼ í”„ë¡œí† íƒ€ì… í† í°ì— ì ìš©"><i class="fas fa-user-circle"></i> í† í°í™”</button>
        <button type="button" class="pill ghost" data-action="open-sheet-config" title="ì‹œíŠ¸ í…Œë§ˆ/ìƒ‰ìƒ"><i class="fas fa-palette"></i> í…Œë§ˆ</button>
      </div>

      <div class="energy-wrap" title="ì—ë„ˆì§€ (í•„ì‚´ê¸° ìì›)">
        <div class="energy-label">âš¡ {{system.combat.energy}} / {{system.combat.energyMax}}</div>
        <div class="energy-bar">
          <div class="bar" style="width: {{energyPct}}%"></div>
        </div>
      </div>
    </div>
  </div>
</header>


  <!-- ===== Unified Tabs (same as character) ===== -->
  <nav class="tabs modern" data-group="primary">
    <a class="item" data-tab="profile"><i class="fas fa-id-card"></i> í”„ë¡œí•„</a>
    <a class="item" data-tab="combat"><i class="fas fa-crosshairs"></i> ì „íˆ¬</a>
    <a class="item" data-tab="gimmick"><i class="fas fa-puzzle-piece"></i> ê¸°ë¯¹</a>
    <a class="item" data-tab="skills"><i class="fas fa-bolt"></i> ìŠ¤í‚¬</a>
    <a class="item" data-tab="notes"><i class="fas fa-sticky-note"></i> ë©”ëª¨</a>
  </nav>

  <section class="sheet-body modern">
    <!-- ===== Profile (optional, kept for unified layout) ===== -->
    <div class="tab" data-group="primary" data-tab="profile">
      <section class="card">
        <h2>í”„ë¡œí•„</h2>
        <p class="hint">ë³´ìŠ¤ ì „ìš© ì •ë³´ëŠ” ììœ ë¡­ê²Œ ì ì–´ë„ ë©ë‹ˆë‹¤.</p>
        <textarea name="system.babylon.note" rows="6" placeholder="ë³´ìŠ¤ í”„ë¡œí•„/íŠ¹ì´ì‚¬í•­">{{system.babylon.note}}</textarea>
      </section>
    </div>

    <!-- ===== Combat ===== -->
    <div class="tab" data-group="primary" data-tab="combat">
      <div class="boss-panels">
        <!-- Shield -->
        <div class="boss-panel">
          <div class="panel-title">
            <span>ğŸ›¡ ë³´í˜¸ë§‰</span>
            <span class="panel-mini">{{shieldPct}}%</span>
          </div>

          <div class="panel-controls">
            <button type="button" class="mini" data-action="shield-dec5">-5</button>
            <button type="button" class="mini" data-action="shield-dec1">-1</button>

            <div class="curmax">
              <input type="number" class="small" name="system.combat.shieldStacks" value="{{system.combat.shieldStacks}}"/>
              <span>/</span>
              <input type="number" class="small" name="system.combat.shieldStacksMax" value="{{system.combat.shieldStacksMax}}"/>
            </div>

            <button type="button" class="mini" data-action="shield-inc1">+1</button>
            <button type="button" class="mini" data-action="shield-inc5">+5</button>
            <button type="button" class="mini ghost" data-action="shield-max">MAX</button>
            <button type="button" class="mini ghost" data-action="shield-zero">0</button>
          </div>

          <div class="stack-grid shield-grid">
            {{#each shieldSlots}}
              <button type="button" class="shield-slot {{#if filled}}filled{{/if}}" data-action="set-shield" data-value="{{value}}" title="{{value}}"></button>
            {{/each}}
            {{#if shieldSlotsOverflow}}
              <div class="stack-overflow">+{{shieldSlotsOverflow}}</div>
            {{/if}}
          </div>

          <progress class="boss-progress" value="{{system.combat.shieldStacks}}" max="{{system.combat.shieldStacksMax}}"></progress>
          <div class="panel-sub">ë³´í˜¸ë§‰ì´ ë‚¨ì•„ìˆìœ¼ë©´ ë¨¼ì € ì†Œëª¨ë©ë‹ˆë‹¤.</div>
        </div>

        <!-- Damage -->
        <div class="boss-panel">
          <div class="panel-title">
            <span>ğŸŸ¥ í”¼ê²© ìŠ¤íƒ</span>
            <span class="panel-mini">{{damagePct}}%</span>
          </div>

          <div class="panel-controls">
            <button type="button" class="mini" data-action="dmg-dec5">-5</button>
            <button type="button" class="mini" data-action="dmg-dec1">-1</button>

            <div class="curmax">
              <input type="number" class="small" name="system.combat.damageStacks" value="{{system.combat.damageStacks}}"/>
              <span>/</span>
              <input type="number" class="small" name="system.combat.damageStacksMax" value="{{system.combat.damageStacksMax}}"/>
            </div>

            <button type="button" class="mini" data-action="dmg-inc1">+1</button>
            <button type="button" class="mini" data-action="dmg-inc5">+5</button>
            <button type="button" class="mini ghost" data-action="dmg-max">MAX</button>
            <button type="button" class="mini ghost" data-action="dmg-zero">0</button>
          </div>

          <div class="stack-grid damage-grid">
            {{#each damageSlots}}
              <button type="button" class="stack-slot {{#if filled}}filled{{/if}}" data-action="set-dmg" data-value="{{value}}" title="{{value}}"></button>
            {{/each}}
            {{#if damageSlotsOverflow}}
              <div class="stack-overflow">+{{damageSlotsOverflow}}</div>
            {{/if}}
          </div>

          <progress class="boss-progress danger" value="{{system.combat.damageStacks}}" max="{{system.combat.damageStacksMax}}"></progress>
          <div class="panel-sub">ë³´í˜¸ë§‰ì´ 0ì´ë©´ í”¼ê²© ìŠ¤íƒì´ ì¦ê°€í•©ë‹ˆë‹¤.</div>
        </div>

        <!-- Energy -->
        <div class="boss-panel">
          <div class="panel-title">
            <span>âš¡ ì—ë„ˆì§€</span>
            <span class="panel-mini">{{energyPct}}%</span>
          </div>

          <div class="panel-controls">
            <button type="button" class="mini" data-action="energy-dec10">-10</button>
            <button type="button" class="mini" data-action="energy-dec1">-1</button>

            <div class="curmax">
              <input type="number" class="small" name="system.combat.energy" value="{{system.combat.energy}}"/>
              <span>/</span>
              <input type="number" class="small" name="system.combat.energyMax" value="{{system.combat.energyMax}}"/>
            </div>

            <button type="button" class="mini" data-action="energy-inc1">+1</button>
            <button type="button" class="mini" data-action="energy-inc10">+10</button>
            <button type="button" class="mini ghost" data-action="energy-max">MAX</button>
            <button type="button" class="mini ghost" data-action="energy-zero">0</button>
            <button type="button" class="mini ghost" data-action="energy-half">50%</button>
          </div>

          <div class="energy-wrap">
            <div class="energy-bar" title="{{system.combat.energy}} / {{system.combat.energyMax}}">
              <div class="bar" style="width: {{energyPct}}%;"></div>
            </div>
            <div class="energy-label">{{system.combat.energy}} / {{system.combat.energyMax}}</div>
          </div>

          <div class="panel-sub">ìŠ¤í‚¬ ì‚¬ìš© ì‹œ ìë™ìœ¼ë¡œ ì¦ê°ë©ë‹ˆë‹¤.</div>
        </div>
      </div>
    </div>

    <!-- ===== Gimmick ===== -->
    <div class="tab" data-group="primary" data-tab="gimmick">
      <section class="boss-gimmicks in-tab">
        <div class="gimmick-head">
          <div class="title">ê¸°ë¯¹ ì²´í¬</div>
          <div class="muted">30ì¹¸</div>
          <div class="spacer"></div>
          <button type="button" class="mini ghost" data-action="reset-gimmicks">ì´ˆê¸°í™”</button>
        </div>

        <div class="gimmick-grid">
          {{#each gimmickSlots}}
            <button type="button" class="gimmick-slot {{#if checked}}checked{{/if}}" data-action="toggle-gimmick" data-index="{{index}}" title="{{label}}"></button>
          {{/each}}
        </div>
      </section>
    </div>

    <!-- ===== Skills ===== -->
    <div class="tab" data-group="primary" data-tab="skills">
      <div class="skill-toolbar modern">
        <div class="skill-left">
          <div class="skill-search">
            <i class="fas fa-search"></i>
            <input type="text" value="{{skillList.query}}" placeholder="ìŠ¤í‚¬ ê²€ìƒ‰â€¦" data-action="skill-query"/>
            <button type="button" class="mini ghost" data-action="skill-clear" title="ê²€ìƒ‰ ì§€ìš°ê¸°"><i class="fas fa-times"></i></button>
          </div>
        </div>

        <div class="skill-right">
          <select data-action="skill-kind" title="ì¢…ë¥˜">
            <option value="all" {{#if (eq skillList.kind "all")}}selected{{/if}}>ì „ì²´</option>
            <option value="basic" {{#if (eq skillList.kind "basic")}}selected{{/if}}>ê¸°ë³¸ê³µê²©</option>
            <option value="skill" {{#if (eq skillList.kind "skill")}}selected{{/if}}>ìŠ¤í‚¬</option>
            <option value="ultimate" {{#if (eq skillList.kind "ultimate")}}selected{{/if}}>í•„ì‚´ê¸°</option>
            <option value="passive" {{#if (eq skillList.kind "passive")}}selected{{/if}}>íŒ¨ì‹œë¸Œ</option>
          </select>

          <select data-action="skill-field" title="ë¶„ì•¼">
            <option value="all" {{#if (eq skillList.field "all")}}selected{{/if}}>ì „ì²´</option>
            <option value="charm" {{#if (eq skillList.field "charm")}}selected{{/if}}>ë§¤ë ¥Â·ì¸ìƒ</option>
            <option value="body" {{#if (eq skillList.field "body")}}selected{{/if}}>ì‹ ì²´Â·ì²´ë ¥</option>
            <option value="tech" {{#if (eq skillList.field "tech")}}selected{{/if}}>ê¸°ìˆ Â·ê¸°êµ</option>
            <option value="will" {{#if (eq skillList.field "will")}}selected{{/if}}>ì˜ì§€Â·ìš©ê¸°</option>
          </select>

          <select data-action="skill-sort" title="ì •ë ¬">
            <option value="name-asc" {{#if (eq skillList.sort "name-asc")}}selected{{/if}}>ì´ë¦„ â†‘</option>
            <option value="name-desc" {{#if (eq skillList.sort "name-desc")}}selected{{/if}}>ì´ë¦„ â†“</option>
            <option value="kind" {{#if (eq skillList.sort "kind")}}selected{{/if}}>ì¢…ë¥˜</option>
            <option value="field" {{#if (eq skillList.sort "field")}}selected{{/if}}>ë¶„ì•¼</option>
          </select>

          <select data-action="skill-group" title="ê·¸ë£¹">
            <option value="none" {{#if (eq skillList.group "none")}}selected{{/if}}>ê·¸ë£¹ ì—†ìŒ</option>
            <option value="kind" {{#if (eq skillList.group "kind")}}selected{{/if}}>ì¢…ë¥˜ë³„</option>
            <option value="field" {{#if (eq skillList.group "field")}}selected{{/if}}>ë¶„ì•¼ë³„</option>
          </select>

          <button type="button" class="pill" data-action="new-skill"><i class="fas fa-plus"></i> ìŠ¤í‚¬ ì¶”ê°€</button>
        </div>
      </div>

      <div class="skill-scroll">
        {{#each skillGroups}}
          {{#if label}}<div class="skill-group-title">{{label}}</div>{{/if}}

          <ol class="skill-list modern">
            {{#each skills}}
              <li class="skill modern" data-item-id="{{id}}">
                <div class="skill-main">
                  <div class="drag" title="ë“œë˜ê·¸"><i class="fas fa-grip-vertical"></i></div>
                  <img class="skill-icon" src="{{img}}" alt=""/>
                  <div class="skill-title">
                    <div class="skill-name">{{name}}</div>
                    <div class="skill-sub">
                      <span class="pill ghost">{{kindText}}</span>
                                            {{#if range}}<span class="pill tag">{{range}}</span>{{/if}}
                      {{#if energyText}}<span class="pill energy">{{energyText}}</span>{{/if}}
                      {{#if tagsText}}<span class="pill tag">{{tagsText}}</span>{{/if}}
                    </div>
                  </div>
                </div>

                <div class="skill-actions">
                  <button type="button" class="pill small use" data-action="use-skill" data-item-id="{{id}}"><i class="fas fa-dice-d20"></i> ì‚¬ìš©</button>
                  <button type="button" class="pill small ghost" data-action="edit-skill" data-item-id="{{id}}"><i class="fas fa-pen"></i></button>
                  <button type="button" class="pill small danger" data-action="delete-skill" data-item-id="{{id}}"><i class="fas fa-trash"></i></button>
                </div>
              </li>
            {{/each}}
          </ol>
        {{/each}}
      </div>
    </div>

    <!-- ===== Notes ===== -->
    <div class="tab" data-group="primary" data-tab="notes">
      <section class="card">
        <h2>ë©”ëª¨</h2>
        <textarea name="system.babylon.note" rows="14" placeholder="ë³´ìŠ¤ ë©”ëª¨">{{system.babylon.note}}</textarea>
      </section>
    </div>
  </section>
</form>
